# Development Setup Guide

This guide will help you set up the ShortletNG project on your local development environment.

---

## Prerequisites

Before starting, ensure you have the following installed on your system:

### Required Software

1. **PHP 8.2 or higher**
   - Download: [https://www.php.net/downloads](https://www.php.net/downloads)
   - On Windows: Use [XAMPP](https://www.apachefriends.org/) or [Laragon](https://laragon.org/)
   - Verify: `php -v`

2. **Composer 2.x**
   - Download: [https://getcomposer.org/download/](https://getcomposer.org/download/)
   - Verify: `composer -V`

3. **Node.js 18.x or higher & npm**
   - Download: [https://nodejs.org/](https://nodejs.org/) (LTS version)
   - Verify: `node -v` and `npm -v`
   - Alternative: Use [pnpm](https://pnpm.io/) for faster installs

4. **MySQL 8.0 or higher**
   - Download: [https://dev.mysql.com/downloads/mysql/](https://dev.mysql.com/downloads/mysql/)
   - Alternative: Use [MariaDB](https://mariadb.org/)
   - Verify: `mysql --version`

5. **Git**
   - Download: [https://git-scm.com/downloads](https://git-scm.com/downloads)
   - Verify: `git --version`

6. **Redis** (optional for queues and caching)
   - Download: [https://redis.io/download](https://redis.io/download)
   - On Windows: [Redis for Windows](https://github.com/microsoftarchive/redis/releases)
   - Verify: `redis-cli --version`

### Recommended Tools

- **VS Code** or **PhpStorm** - Code editor
- **TablePlus** or **phpMyAdmin** - Database management
- **Postman** or **Insomnia** - API testing (if needed)

### PHP Extensions Required

Ensure these PHP extensions are enabled:

```ini
- php_openssl
- php_pdo
- php_pdo_mysql
- php_mbstring
- php_tokenizer
- php_xml
- php_ctype
- php_json
- php_bcmath
- php_fileinfo
- php_redis (optional)
```

Check enabled extensions:
```bash
php -m
```

---

## Project Setup

### 1. Clone the Repository

```bash
# Clone the repository
git clone https://github.com/your-username/shortletng.git

# Navigate to project directory
cd shortletng
```

### 2. Install Backend Dependencies

```bash
# Install PHP dependencies via Composer
composer install
```

If you encounter memory issues:
```bash
COMPOSER_MEMORY_LIMIT=-1 composer install
```

### 3. Install Frontend Dependencies

```bash
# Install Node.js dependencies
npm install

# Or using pnpm (faster)
pnpm install
```

### 4. Environment Configuration

```bash
# Copy the example environment file
cp .env.example .env

# Generate application key
php artisan key:generate
```

### 5. Configure Environment Variables

Edit the `.env` file with your local configuration:

```env
# Application
APP_NAME=ShortletNG
APP_ENV=local
APP_KEY=base64:... (generated by artisan key:generate)
APP_DEBUG=true
APP_URL=http://localhost:8000

# Database
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=shortletng
DB_USERNAME=root
DB_PASSWORD=your_password

# Redis (optional)
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

# Queue
QUEUE_CONNECTION=sync  # Use 'redis' for production

# Mail (use Mailtrap for testing)
MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=your_mailtrap_username
MAIL_PASSWORD=your_mailtrap_password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@shortletng.com
MAIL_FROM_NAME="${APP_NAME}"

# Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
GOOGLE_REDIRECT_URI="${APP_URL}/auth/google/callback"

# Payment Gateways
PAYMENT_PROVIDER=paystack  # or 'flutterwave'

# Paystack
PAYSTACK_PUBLIC_KEY=your_paystack_public_key
PAYSTACK_SECRET_KEY=your_paystack_secret_key
PAYSTACK_MERCHANT_EMAIL=your_email@example.com

# Flutterwave
FLUTTERWAVE_PUBLIC_KEY=your_flutterwave_public_key
FLUTTERWAVE_SECRET_KEY=your_flutterwave_secret_key
FLUTTERWAVE_ENCRYPTION_KEY=your_flutterwave_encryption_key

# FilamentPHP
FILAMENT_PATH=admin
```

### 6. Create Database

```bash
# Login to MySQL
mysql -u root -p

# Create database
CREATE DATABASE shortletng CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# Exit MySQL
exit;
```

Or use your database management tool (TablePlus, phpMyAdmin, etc.)

### 7. Run Migrations

```bash
# Run database migrations
php artisan migrate

# Or with confirmation skip (fresh install)
php artisan migrate --seed
```

### 8. Seed Database (Optional)

```bash
# Seed amenities and sample data
php artisan db:seed

# Or seed specific seeder
php artisan db:seed --class=AmenitySeeder
```

### 9. Link Storage

```bash
# Create symbolic link for public storage
php artisan storage:link
```

### 10. Build Frontend Assets

```bash
# Development build with hot reload
npm run dev

# Or build for production
npm run build
```

---

## Running the Application

### Development Server

**Terminal 1: Laravel Server**
```bash
php artisan serve
```
Application will be available at: `http://localhost:8000`

**Terminal 2: Vite Dev Server** (for hot reload)
```bash
npm run dev
```

**Terminal 3: Queue Worker** (optional, if using queues)
```bash
php artisan queue:work
```

### Access Points

- **Frontend**: http://localhost:8000
- **Admin Panel**: http://localhost:8000/admin
- **API** (if needed): http://localhost:8000/api

---

## Setting Up External Services

### 1. Google OAuth Setup

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing
3. Enable Google+ API
4. Go to "Credentials" → "Create Credentials" → "OAuth 2.0 Client ID"
5. Configure OAuth consent screen
6. Add authorized redirect URI: `http://localhost:8000/auth/google/callback`
7. Copy Client ID and Client Secret to `.env`

### 2. Paystack Setup

1. Sign up at [Paystack](https://paystack.com/)
2. Go to Settings → API Keys & Webhooks
3. Copy Public Key and Secret Key
4. Add to `.env` file
5. For testing, use Test keys

### 3. Flutterwave Setup

1. Sign up at [Flutterwave](https://flutterwave.com/)
2. Go to Settings → API
3. Copy Public Key, Secret Key, and Encryption Key
4. Add to `.env` file
5. For testing, use Test keys

### 4. Mailtrap Setup (Email Testing)

1. Sign up at [Mailtrap](https://mailtrap.io/)
2. Go to Email Testing → Inboxes
3. Copy SMTP credentials
4. Add to `.env` file
5. All emails will be caught by Mailtrap (no real emails sent)

---

## Code Quality Tools

### Install and Configure

```bash
# Install PHP CS Fixer
composer require --dev friendsofphp/php-cs-fixer

# Install ESLint and Prettier
npm install --save-dev eslint prettier eslint-plugin-vue

# Install Tailwind CSS IntelliSense (VS Code extension)
```

### Run Linters

```bash
# Format PHP code
vendor/bin/php-cs-fixer fix

# Lint Vue/JS code
npm run lint

# Format with Prettier
npm run format
```

---

## FilamentPHP Admin Panel

### Create Admin User

```bash
# Run the admin seeder
php artisan db:seed --class=AdminUserSeeder

# Or create manually
php artisan make:filament-user
```

Default admin credentials (if using seeder):
- Email: `admin@shortletng.com`
- Password: `password` (change this!)

Access admin panel: `http://localhost:8000/admin`

---

## Common Issues & Troubleshooting

### Issue 1: "The stream or file could not be opened"

**Solution**: Fix storage permissions
```bash
# Windows
# Right-click storage and bootstrap/cache folders → Properties → Security → Edit permissions

# Linux/Mac
chmod -R 775 storage bootstrap/cache
```

### Issue 2: "SQLSTATE[HY000] [1045] Access denied"

**Solution**: Check database credentials in `.env`
```bash
# Verify MySQL is running
# Verify DB_USERNAME and DB_PASSWORD in .env
# Ensure database exists
```

### Issue 3: "Vite manifest not found"

**Solution**: Build frontend assets
```bash
npm run dev
# Or
npm run build
```

### Issue 4: "Class 'Redis' not found"

**Solution**: Install Redis PHP extension or change queue connection
```bash
# In .env, change:
QUEUE_CONNECTION=sync
# Instead of:
QUEUE_CONNECTION=redis
```

### Issue 5: "npm ERR! code ERESOLVE"

**Solution**: Use legacy peer deps
```bash
npm install --legacy-peer-deps
```

### Issue 6: Composer memory limit error

**Solution**: Increase memory limit
```bash
COMPOSER_MEMORY_LIMIT=-1 composer install
```

---

## Development Workflow

### Daily Workflow

1. **Pull latest changes**
   ```bash
   git pull origin develop
   ```

2. **Update dependencies** (if composer.json or package.json changed)
   ```bash
   composer install
   npm install
   ```

3. **Run migrations** (if new migrations added)
   ```bash
   php artisan migrate
   ```

4. **Start development servers**
   ```bash
   # Terminal 1
   php artisan serve

   # Terminal 2
   npm run dev
   ```

5. **Make changes and test**

6. **Commit and push** (see GIT_WORKFLOW.md)

---

## Testing

### Run Tests

```bash
# Run all tests
php artisan test

# Run specific test
php artisan test --filter BookingTest

# Run with coverage
php artisan test --coverage
```

### Frontend Tests

```bash
# Run Vitest tests
npm run test

# Run with coverage
npm run test:coverage
```

---

## Database Management

### Reset Database

```bash
# Drop all tables and re-run migrations
php artisan migrate:fresh

# With seeding
php artisan migrate:fresh --seed
```

### Create Migration

```bash
php artisan make:migration create_properties_table
```

### Create Seeder

```bash
php artisan make:seeder PropertySeeder
```

---

## Useful Artisan Commands

```bash
# Clear caches
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear

# List all routes
php artisan route:list

# Create model with migration and factory
php artisan make:model Property -mf

# Create controller
php artisan make:controller PropertyController

# Create service
php artisan make:class Services/BookingService

# Create request
php artisan make:request StoreBookingRequest

# Tinker (REPL)
php artisan tinker
```

---

## Environment-Specific Notes

### Windows (XAMPP/Laragon)

- Ensure Apache/MySQL are running
- PHP path should be in system PATH
- Use Command Prompt or PowerShell

### macOS

- Install PHP via Homebrew: `brew install php`
- Install MySQL via Homebrew: `brew install mysql`
- Start services: `brew services start mysql`

### Linux (Ubuntu/Debian)

```bash
# Install PHP
sudo apt update
sudo apt install php8.2 php8.2-cli php8.2-common php8.2-mysql php8.2-xml php8.2-mbstring

# Install Composer
curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer

# Install MySQL
sudo apt install mysql-server
```

---

## Next Steps

After setup is complete:

1. Review **FEATURE_ROADMAP.md** to understand the project structure
2. Review **CODING_STANDARDS.md** for coding conventions
3. Review **DESIGN_SYSTEM.md** for UI/UX guidelines
4. Start with Phase 0 tasks in the roadmap
5. Commit your work following **GIT_WORKFLOW.md**

---

## Getting Help

- Check Laravel docs: https://laravel.com/docs
- Check Vue.js docs: https://vuejs.org/guide/
- Check Inertia.js docs: https://inertiajs.com/
- Check FilamentPHP docs: https://filamentphp.com/docs
- Check Tailwind CSS docs: https://tailwindcss.com/docs

---

**Happy coding!** If you encounter issues not covered here, document them and update this guide.
